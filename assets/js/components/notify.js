let state="open-notify",substate="welcome",unread=[],currentHeight=0,pageDetails={page_name:"Complete voice",welcome_message:"hello there!"};function log(e){debug&&console.log(e)}const notify_message=Object.create({create(e){log("msgbody",e);const t=document.createElement("div");return t.classList.add("msg"),"welcome"===state&&t.classList.add("welcome_msg"),t.innerText=e.msg_body,t}}),notify_stop=Object.create({create(e="body"){const t=document.createElement("i");return t.classList.add("fa","fa-times","closebtn"),t.setAttribute("aria-hidden","true"),t.addEventListener("click",function(){parent.postMessage({trigger:"close",component:"notify"},listenTo),unread=[],currentHeight=0}),t}}),notify_meta=Object.create({create(e){const t=document.createElement("div");let n=new Date(e.timestamp);return t.classList.add("info"),log(pageDetails.agents.find(t=>t._id===e.msg_author).name.split(" ")[0]),t.innerHTML=`<p>${pageDetails.agents.find(t=>t._id===e.msg_author).name.split(" ")[0]||"agent"}</p><p>${n.getHours()+":"+n.getMinutes()}</p>`,t}}),notify=Object.create({create(e,t="body",n="afterBegin"){const a=document.createElement("div");a.classList.add("unread"),unread.unshift(e),unread.length>10&&unread.splice(unread.length-1,1),log(unread),unread.length>0&&(a.appendChild(notify_stop.create()),unread.forEach(e=>{const t=document.createElement("div");t.classList.add("chat-off"),t.appendChild(notify_message.create(e)),log("ghgfudgf",state),"welcome"!==substate&&t.appendChild(notify_meta.create(e)),t.addEventListener("click",()=>{unread=[],parent.postMessage({trigger:"close",component:"notify"},listenTo),parent.postMessage({trigger:"open",component:"mainchat"},listenTo),currentHeight=0}),a.appendChild(t)})),append(t,a,n,!0),"welcome"===substate&&(unread=[],substate="notify")}});function eventer(){let e=window.addEventListener?"addEventListener":"attachEvent",t=window[e],n="attachEvent"===e?"onmessage":"message";parent.postMessage({trigger:"online",component:"notify"},listenTo),t(n,function(e){~e.origin.indexOf(listenTo)&&(log(e,"in notify"),"online"!==e.data.trigger&&(state=e.data.trigger,console.log("statehere",state)),"open-notify"===e.data.trigger&&notify.create(e.data.message),"open"===e.data.trigger&&(unread=[],document.body.innerHTML=""))},!1),log("notify started")}function append(e,t,n,a){a&&Array.prototype.forEach.call(document.getElementsByClassName(t.className),e=>{e.remove()}),document.querySelector(e).insertAdjacentElement(n,t)}!function(){let e=JSON.parse(localStorage.getItem(`${page_id}-visited`)||null),t="";e?t=`Welcome back to ${pageDetails.page_name}`:(localStorage.setItem(`${page_id}-visited`,JSON.stringify(!0)),t=pageDetails.welcome_message||"hello there!"),eventer(),setTimeout(function(){"open"!==state&&"close"!==state&&parent.postMessage({trigger:"open-notify",message:{msg_body:t},component:"notify"},listenTo)},5e3)}();