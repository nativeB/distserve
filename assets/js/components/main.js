let mode="nocall",submode="",previous="",data={},defwelcome="Hey there!",defcolor="#0084ff",pageDetails={page_name:"Hadia"},userDetails=JSON.parse(localStorage.getItem("Fam-currentUser")||null),fammsgs=JSON.parse(localStorage.getItem("Fam-userMessages")||null),alt_agent="https://res.cloudinary.com/dxdkjddi2/image/upload/v1534935698/cs%20website/default-avatar.png",state="close",globalcolors={color:hasprop("theme_contrast_color",pageDetails)?pageDetails.theme_contrast_color:"white",theme_color:hasprop("theme_color",pageDetails)?pageDetails.theme_color:defcolor};log(globalcolors.color);const title_widget=Object.create({create(){const e=document.createElement("div");return e.classList.add("chat-title"),e.style.setProperty("background-color",globalcolors.theme_color,"important"),e.style.setProperty("color",globalcolors.color,"important"),e}}),image_widget=Object.create({create(e,t){const a=document.createElement("img");return a.classList.add(...t),a.src=e,a.alt="A",a}}),agents_logo_widget=Object.create({create(e){const t=document.createElement("div");return t.classList.add("agent-face"),t.innerHTML='<div class="half"></div>',t.querySelector(".half").appendChild(image_widget.create(e.profile_pic,["agent","circle"])),t.append(e.name.split(" ")[0]||"Agent"),t}}),message_widget=Object.create({create(e){const t=document.createElement("p");return t.classList.add("state_message"),t.innerText=e,t}}),pagename=Object.create({create(e){const t=document.createElement("div");return t.innerHTML=`<h1 class="businessname">${pageDetails.page_name}</h1>`,t}}),message_title_widget=Object.create({create(e=".chat",t="afterBegin"){const a=document.createElement("div");a.classList.add("agent-view"),!1===pageDetails.automation?a.appendChild(pagename.create(!1)):(a.appendChild(pagename.create("card")),log("comming here"));const n=title_widget.create();n.style.setProperty("min-height","100px","important"),n.appendChild(a),append(e,n,t,!0)}}),calling_widget=Object.create({create(){const e=document.createElement("div");return e.classList.add("hadia_call_in_progress"),e.addEventListener("click",()=>{endCall()}),e}}),place_call_widget=Object.create({create(){const e=document.createElement("div");return e.classList.add("hadia_place_call"),e.addEventListener("click",()=>{getUserTokenAndStartCall()}),e}}),speech_widget=Object.create({create(){const e=document.createElement("div");e.id="hadia_speech_bars";for(let t=0;t<=9;t++){let t=document.createElement("div");t.classList.add("hadia_speech_bar"),e.appendChild(t)}return e}}),main_page_widget=Object.create({create(e=".chat-title",t="afterEnd"){const a=document.createElement("div");a.classList.add("main_display"),"nocall"===mode?a.appendChild(place_call_widget.create()):"calling"===mode?a.appendChild(calling_widget.create()):"conversing"===mode&&a.appendChild(speech_widget.create()),append(e,a,t,!0)}}),a_card_tag=Object.create({create(e,t){const a=document.createElement("a");return a.classList.add(...t),a.type="button",a.innerText=e,a.style.setProperty("color",globalcolors.theme_color,"important"),a.style.setProperty("border",`1px solid ${globalcolors.theme_color}`,"important"),a}}),footer=Object.create({create(e=".main_display",t="afterEnd"){const a=document.createElement("div");a.classList.add("footer-note"),a.innerHTML='<a class="fam-brand" target="_blank" href="https://fam.ai"><span>âš¡ by </span>Hadia</a>',append(e,a,t,!0)}});function isEmpty(e){for(let t in e)if(e.hasOwnProperty(t))return!1;return!0}function append(e,t,a,n){n&&Array.prototype.forEach.call(document.getElementsByClassName(t.className),e=>{e.remove()}),document.querySelector(e).insertAdjacentElement(a,t)}function isUrl(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}function constantcomponent(){message_title_widget.create(),main_page_widget.create(),footer.create()}function eventer(){let e=window.addEventListener?"addEventListener":"attachEvent",t=window[e],a="attachEvent"===e?"onmessage":"message";parent.postMessage({trigger:"online",component:"mainchat"},listenTo),t(a,e=>{~e.origin.indexOf(listenTo)&&("close"!==e.data.trigger&&"open"!==e.data.trigger||(main_page_widget.create(),state=e.data.trigger))},!1)}function log(e){debug&&console.log(e)}function hasprop(e,t){return log(e,t,t.hasOwnProperty(e)),t.hasOwnProperty(e)}document.body.insertAdjacentHTML("afterBegin",'<section class="avenue-messenger">\n        <div style="display: none;" id="user"></div><div  style="display: none;" id="agent"></div><div class="menu"><div id="close_btn" class="button">&#10005;</div></div><div class="chat"></div></section>'),constantcomponent(),document.querySelector(".chat").addEventListener("click",e=>{log(e.target.parentNode.id),document.querySelector("#emoji-picker")&&!e.target.classList.contains("fa-smile-o")&&(document.querySelector("#emoji-picker").contains(e.target)||stopemoji())}),document.querySelector("#close_btn").addEventListener("click",e=>{parent.postMessage({trigger:"close",component:"mainchat"},listenTo)}),eventer();