let pageDetails={theme_color:"#0084ff"},userDetails=null,ticketDetails=null,state="close",userProps={};function log(e){debug&&console.log(e)}const icon_widget=Object.create({create(e,t){const n=document.createElement("a");n.classList.add("ctrlq","fb-button"),n.id="testbtn",n.style.backgroundColor=e,append(t,n)}});function append(e,t){document.querySelector(e).appendChild(t)}const init_user=()=>fetch(`${hadia_live_api}user/initialize`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:page_id})}).then(e=>e.json()).catch(e=>e),set_user_prop=e=>(log("running",e),fetch(`${hadia_live_api}faquser/channel/livechat/edit/`,{method:"put",headers:{faquser_id:userDetails._id,faquser_token:userDetails.token,"Content-Type":"application/json"},body:JSON.stringify(userProps)}).then(e=>e.json()).catch(e=>e));function initAll(){icon_widget.create(pageDetails.hasOwnProperty("theme_color")?pageDetails.theme_color:"#0084ff","body"),eventer(),document.querySelector("#testbtn").addEventListener("click",function(){log(state),"close"===state||"open-notify"===state?(parent.postMessage({trigger:"close",component:"notify",default:!0},listenTo),parent.postMessage({trigger:"open",component:"mainchat"},listenTo),parent.postMessage({trigger:"changeCss",component:"notify",props:{key:"height",value:"0px"}},listenTo)):"open"===state&&parent.postMessage({trigger:"close",component:"mainchat"},listenTo)})}function eventer(){let e=window.addEventListener?"addEventListener":"attachEvent";(0,window[e])("attachEvent"===e?"onmessage":"message",function(e){~e.origin.indexOf(listenTo)&&(log("setUser"===e.data.trigger,"in main"),"online"!==e.data.trigger&&"setUser"===e.data.trigger?userProps=e.data.customUserProps:e.data.trigger&&(state=e.data.trigger))},!1),parent.postMessage({trigger:"online",component:"icon"},listenTo),parent.postMessage({trigger:"init_chat"},listenTo),log("post")}console.log(page_id,user_id),page_id&&!user_id?init_user().then(e=>{if(!e.success)return console.error("An error occurred ");parent.postMessage({trigger:"setUserId",user_id:e.user._id},listenTo),localStorage.setItem("hadia-currentUser",JSON.stringify(e.user._id)),initAll()}).catch(e=>console.error("An error occurred ",e)):page_id&&user_id?initAll():console.error("no id provided");